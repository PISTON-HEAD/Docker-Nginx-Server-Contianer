name: IBE Integration Onboarding Workflow

on:
  issues:
    types: [opened]
  issue_comment:
    types: [created]

permissions:
  contents: read
  issues: write

jobs:

  # ---------------------------
  # 1. Handle Issue Creation
  # ---------------------------
  request_approval:
    runs-on: ubuntu-latest
    if: github.event_name == 'issues' &&
        startsWith(github.event.issue.title, '[Onboarding]')
    steps:

      - name: Add pending-approval label
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              labels: ["pending-approval"]
            })

      - name: Comment approval required instructions
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: "⚠️ **Approval Required**\nPlease comment **/approve** to continue."
            })


  # ---------------------------
  # 2. Approval Check (Triggered by Comment)
  # ---------------------------
  check_approval:
    runs-on: ubuntu-latest
    if: github.event_name == 'issue_comment' &&
        github.event.issue.pull_request == null &&
        startsWith(github.event.issue.title, '[Onboarding]') &&
        contains(github.event.comment.body, '/approve')
    outputs:
      approved: "true"
    steps:

      - name: Log approval detection
        run: echo "Approval detected for issue #${{ github.event.issue.number }}"

      - name: Add first-level-approved label
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              labels: ["first-level-approved"]
            })

      - name: Comment approval message
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: conte_
